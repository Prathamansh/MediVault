<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0078D7" />
    <meta
      name="description"
      content="MediVault - Your secure medical information repository"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>MediVault - Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                light: '#4DA8DA',
                DEFAULT: '#0078D7',
                dark: '#005A9E',
              },
              secondary: {
                light: '#F8FAFC',
                DEFAULT: '#E5E7EB',
                dark: '#6B7280',
              },
              emergency: {
                DEFAULT: '#DC2626',
              }
            },
            boxShadow: {
              'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            }
          },
        }
      };
    </script>
    <!-- Custom CSS -->
    <style>
      body {
        font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
        background-color: #F3F4F6;
      }
      .dashboard-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .navbar {
        background-color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 1rem;
      }
      .logo {
        font-weight: 700;
        font-size: 1.5rem;
        color: #0078D7;
      }
      .sidebar {
        width: 240px;
        background-color: white;
        height: calc(100vh - 64px);
        position: fixed;
        left: 0;
        top: 64px;
        border-right: 1px solid #E5E7EB;
        overflow-y: auto;
      }
      .sidebar-menu {
        padding: 1.5rem 0;
      }
      .sidebar-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        color: #4B5563;
        font-weight: 500;
        transition: background-color 0.15s, color 0.15s;
      }
      .sidebar-link:hover, .sidebar-link.active {
        background-color: #F3F4F6;
        color: #0078D7;
      }
      .sidebar-link i {
        margin-right: 0.75rem;
        width: 20px;
        text-align: center;
      }
      .main-content {
        margin-left: 240px;
        padding: 2rem;
        flex: 1;
      }
      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1F2937;
        margin-bottom: 1.5rem;
      }
      .profile-card, .medical-card, .appointments-card, .records-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        margin-bottom: 2rem;
        overflow: hidden;
      }
      .card-header {
        background-color: #F9FAFB;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #E5E7EB;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .card-title {
        font-weight: 600;
        color: #1F2937;
      }
      .card-content {
        padding: 1.5rem;
      }
      .profile-info {
        display: flex;
        align-items: center;
      }
      .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-color: #E5E7EB;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1.5rem;
        overflow: hidden;
      }
      .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .profile-details .name {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1F2937;
        margin-bottom: 0.25rem;
      }
      .profile-details .email {
        color: #6B7280;
        margin-bottom: 0.5rem;
      }
      .profile-details .info-label {
        font-weight: 500;
        color: #4B5563;
        margin-right: 0.5rem;
      }
      .medical-data {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }
      .medical-info-item {
        background-color: #F9FAFB;
        border-radius: 0.5rem;
        padding: 1rem;
      }
      .medical-info-label {
        font-size: 0.875rem;
        color: #6B7280;
        margin-bottom: 0.25rem;
      }
      .medical-info-value {
        font-weight: 600;
        color: #1F2937;
      }
      .appointments-list {
        display: grid;
        gap: 1rem;
      }
      .appointment-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
      }
      .appointment-date {
        flex-shrink: 0;
        width: 60px;
        height: 60px;
        background-color: #0078D7;
        color: white;
        border-radius: 0.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
      }
      .appointment-date .day {
        font-weight: 700;
        font-size: 1.25rem;
      }
      .appointment-date .month {
        font-size: 0.75rem;
      }
      .appointment-details .title {
        font-weight: 500;
        color: #1F2937;
        margin-bottom: 0.25rem;
      }
      .appointment-details .doctor, .appointment-details .location {
        font-size: 0.875rem;
        color: #6B7280;
      }
      .records-list {
        display: grid;
        gap: 1rem;
      }
      .record-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
      }
      .record-icon {
        flex-shrink: 0;
        width: 40px;
        height: 40px;
        border-radius: 0.5rem;
        background-color: #F3F4F6;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
      }
      .record-details {
        flex: 1;
      }
      .record-details .title {
        font-weight: 500;
        color: #1F2937;
        margin-bottom: 0.25rem;
      }
      .record-details .date {
        font-size: 0.875rem;
        color: #6B7280;
      }
      .record-actions {
        display: flex;
        gap: 0.5rem;
      }
      .record-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 0.25rem;
        background-color: #F9FAFB;
        color: #6B7280;
        border: 1px solid #E5E7EB;
        transition: background-color 0.15s, color 0.15s;
      }
      .record-btn:hover {
        background-color: #F3F4F6;
        color: #1F2937;
      }
      .btn-primary {
        background-color: #0078D7;
        color: white;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        text-align: center;
        transition: background-color 0.15s;
        cursor: pointer;
        border: none;
      }
      .btn-primary:hover {
        background-color: #005A9E;
      }
      .section-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .emergency-button {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        background-color: #DC2626;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.25rem;
        border-radius: 9999px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(220, 38, 38, 0.25);
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .emergency-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 10px rgba(220, 38, 38, 0.3);
      }
      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          z-index: 50;
        }
        .sidebar.active {
          transform: translateX(0);
        }
        .main-content {
          margin-left: 0;
        }
        .menu-toggle {
          display: block;
        }
        .section-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 768px) {
        .medical-data {
          grid-template-columns: 1fr;
        }
      }

      /* Complete Your Profile Styles */
      .profile-completion-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        margin-bottom: 2rem;
        overflow: hidden;
      }
      .profile-completion-progress {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .progress-bar {
        flex: 1;
        height: 8px;
        background-color: #E5E7EB;
        border-radius: 9999px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #0078D7, #4DA8DA);
        border-radius: 9999px;
      }
      .completion-percentage {
        font-size: 0.875rem;
        font-weight: 500;
        color: #4B5563;
      }
      .section-subtitle {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1F2937;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
      }
      .form-sections {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }
      .form-section {
        padding: 1rem;
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
        background-color: #F9FAFB;
      }
      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #D1D5DB;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        transition: border-color 0.15s, box-shadow 0.15s;
      }
      .form-input:focus {
        outline: none;
        border-color: #0078D7;
        box-shadow: 0 0 0 3px rgba(0, 120, 215, 0.1);
      }
      textarea.form-input {
        resize: vertical;
        min-height: 80px;
      }
      .document-upload-area {
        margin-top: 1rem;
      }
      .upload-container {
        border: 2px dashed #D1D5DB;
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s, background-color 0.2s;
      }
      .upload-container:hover {
        border-color: #0078D7;
        background-color: #F0F9FF;
      }
      .upload-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        color: #4B5563;
        cursor: pointer;
      }
      .upload-label i {
        font-size: 2rem;
        color: #0078D7;
      }
      .upload-label small {
        color: #6B7280;
        font-size: 0.75rem;
      }
      .uploaded-documents {
        margin-top: 1rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
      }
      .document-preview {
        border: 1px solid #E5E7EB;
        border-radius: 0.375rem;
        overflow: hidden;
        position: relative;
      }
      .document-preview-image {
        width: 100%;
        height: 100px;
        object-fit: cover;
        background-color: #F3F4F6;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .document-preview-info {
        padding: 0.5rem;
        font-size: 0.75rem;
      }
      .document-preview-actions {
        position: absolute;
        top: 0.25rem;
        right: 0.25rem;
        display: flex;
        gap: 0.25rem;
      }
      .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: #4B5563;
        transition: color 0.15s;
      }
      .btn-icon:hover {
        color: #1F2937;
      }
      .form-actions {
        margin-top: 2rem;
        display: flex;
        justify-content: flex-end;
      }
      .hidden {
        display: none;
      }
      .summary-section {
        margin-bottom: 1.5rem;
      }
      
      .summary-item {
        display: flex;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .summary-item:last-child {
        border-bottom: none;
      }
      
      .summary-label {
        font-weight: 500;
        color: #4b5563;
        width: 40%;
        flex-shrink: 0;
      }
      
      .summary-value {
        color: #1f2937;
      }
      
      /* Animation classes */
      .slide-up-fade-out {
        animation: slideUpFadeOut 0.5s ease forwards;
        overflow: hidden;
      }
      
      .slide-down-fade-in {
        animation: slideDownFadeIn 0.5s ease forwards;
        overflow: hidden;
      }
      
      @keyframes slideUpFadeOut {
        0% {
          opacity: 1;
          max-height: 2000px;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          max-height: 0;
          transform: translateY(-10px);
        }
      }
      
      @keyframes slideDownFadeIn {
        0% {
          opacity: 0;
          max-height: 0;
          transform: translateY(-10px);
        }
        100% {
          opacity: 1;
          max-height: 2000px;
          transform: translateY(0);
        }
      }
      
      /* Toast notification */
      .toast {
        position: fixed;
        top: 1rem;
        right: 1rem;
        padding: 0.75rem 1.5rem;
        background-color: #10B981;
        color: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 9999;
        opacity: 0;
        transform: translateY(-20px);
        animation: toastAppear 0.3s ease forwards, toastDisappear 0.3s ease forwards 3s;
      }
      
      @keyframes toastAppear {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes toastDisappear {
        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }

      /* Hidden class for toggling sections */
      .hidden {
        display: none !important;
      }
      
      /* Medical Records Section Styles */
      #medical-records-section {
        padding: 20px;
      }
      
      .upload-container {
        background-color: #f8fafc;
        border: 2px dashed #cbd5e1;
        border-radius: 8px;
        padding: 24px;
        text-align: center;
        margin-bottom: 24px;
        transition: all 0.3s ease;
      }
      
      .upload-container:hover {
        border-color: #94a3b8;
        background-color: #f1f5f9;
      }
      
      .upload-icon {
        font-size: 48px;
        color: #64748b;
        margin-bottom: 12px;
      }
      
      .upload-title {
        font-size: 18px;
        font-weight: 600;
        color: #334155;
        margin-bottom: 8px;
      }
      
      .upload-instruction {
        color: #64748b;
        margin-bottom: 16px;
      }
      
      .upload-btn {
        background-color: #3b82f6;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
        display: inline-block;
      }
      
      .upload-btn:hover {
        background-color: #2563eb;
      }
      
      .file-input {
        display: none;
      }
      
      .upload-status {
        margin-top: 16px;
        padding: 12px;
        border-radius: 6px;
      }
      
      .upload-progress {
        background-color: #eff6ff;
        color: #1e40af;
      }
      
      .upload-error {
        background-color: #fee2e2;
        color: #b91c1c;
      }
      
      .upload-success {
        background-color: #ecfdf5;
        color: #065f46;
      }
      
      /* Records list styles */
      .records-container {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      
      .records-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background-color: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
      }
      
      .records-title {
        font-size: 18px;
        font-weight: 600;
        color: #334155;
        margin: 0;
      }
      
      .refresh-btn {
        background-color: transparent;
        color: #64748b;
        border: 1px solid #cbd5e1;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.2s;
      }
      
      .refresh-btn:hover {
        background-color: #f1f5f9;
        color: #334155;
      }
      
      .records-loading, .records-empty {
        padding: 40px 20px;
        text-align: center;
        color: #64748b;
      }
      
      .loading-spinner {
        font-size: 24px;
        margin-bottom: 12px;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .record-item {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        border-bottom: 1px solid #e2e8f0;
        transition: background-color 0.2s;
      }
      
      .record-item:last-child {
        border-bottom: none;
      }
      
      .record-item:hover {
        background-color: #f8fafc;
      }
      
      .record-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f1f5f9;
        border-radius: 8px;
        margin-right: 16px;
      }
      
      .record-icon i {
        font-size: 24px;
      }
      
      .record-details {
        flex: 1;
      }
      
      .record-name {
        font-size: 16px;
        font-weight: 500;
        color: #334155;
        margin: 0 0 4px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 300px;
      }
      
      .record-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
        color: #64748b;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
      }
      
      .btn-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        background-color: transparent;
        color: #64748b;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .btn-icon:hover {
        background-color: #f1f5f9;
        color: #334155;
      }
      
      .view-record:hover {
        color: #3b82f6;
        border-color: #bfdbfe;
      }
      
      .download-record:hover {
        color: #10b981;
        border-color: #a7f3d0;
      }
      
      .analyze-record:hover {
        color: #8b5cf6;
        border-color: #ddd6fe;
      }
      
      .delete-record:hover {
        color: #ef4444;
        border-color: #fecaca;
      }
      
      /* Color utilities */
      .text-red-500 {
        color: #ef4444;
      }
      
      .text-blue-500 {
        color: #3b82f6;
      }
      
      .text-gray-500 {
        color: #64748b;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Navigation -->
      <nav class="navbar">
        <div class="flex justify-between items-center">
          <div class="flex items-center">
            <button id="menu-toggle" class="menu-toggle mr-4 block lg:hidden">
              <i class="fas fa-bars"></i>
            </button>
            <a href="index.html" class="logo">MediVault</a>
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative">
              <button id="notifications-btn" class="relative p-2">
                <i class="far fa-bell"></i>
                <span class="absolute top-0 right-0 w-2 h-2 bg-emergency rounded-full"></span>
              </button>
            </div>
            <div class="user-menu relative">
              <button id="user-menu-btn" class="flex items-center">
                <span id="user-name" class="mr-2 hidden md:block">John Doe</span>
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <i class="fas fa-user text-gray-500"></i>
                </div>
              </button>
              <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden">
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                <button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</button>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Sidebar -->
      <div id="sidebar" class="sidebar">
        <div class="sidebar-menu">
          <a href="#" class="sidebar-link active" id="dashboard-link">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
          <a href="#" class="sidebar-link" id="medical-records-link">
            <i class="fas fa-file-medical"></i>
            <span>Medical Records</span>
          </a>
          <a href="ocr-upload.html" class="sidebar-link">
            <i class="fas fa-file-search"></i>
            <span>Medical OCR</span>
          </a>
          <a href="#" class="sidebar-link">
            <i class="fas fa-pills"></i>
            <span>Medications</span>
          </a>
          <a href="#" class="sidebar-link">
            <i class="fas fa-allergies"></i>
            <span>Allergies</span>
          </a>
          <a href="#" class="sidebar-link">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div id="dashboard-section">
          <h1 class="section-title">Dashboard</h1>

          <!-- Profile Card -->
          <div class="profile-card">
            <div class="card-header">
              <h2 class="card-title">Personal Information</h2>
              <button id="edit-profile-btn-header" class="btn-primary">Edit Profile</button>
            </div>
            <div class="card-content">
              <div class="profile-info">
                <div class="profile-avatar">
                  <i class="fas fa-user fa-3x text-gray-400"></i>
                </div>
                <div class="profile-details">
                  <h3 id="profile-name" class="name">John Doe</h3>
                  <p id="profile-email" class="email">john.doe@example.com</p>
                  <div id="profile-bloodtype-container" class="hidden">
                    <p><span class="info-label">Blood Type:</span> <span id="profile-bloodtype">O+</span></p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Complete Your Profile Card -->
          <div class="profile-completion-card">
            <div class="card-header">
              <h2 class="card-title">Complete Your Profile</h2>
              <div class="profile-completion-progress">
                <div class="progress-bar">
                  <div id="progress-fill" class="progress-fill" style="width: 30%;"></div>
                </div>
                <span id="completion-percentage">30% Complete</span>
              </div>
            </div>
            <div class="card-content">
              <p class="mb-4 text-gray-600">
                <i class="fas fa-shield-alt text-primary mr-2"></i>
                Your medical data is encrypted and securely stored. Only you control who can access it.
              </p>
              
              <!-- Profile Summary Section (hidden initially) -->
              <div id="profile-summary" class="hidden">
                <!-- Success message div removed -->
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Personal Details Summary -->
                  <div class="summary-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-user-circle text-primary mr-2"></i>
                      Personal Details
                    </h3>
                    <div class="p-3 bg-gray-50 rounded-md">
                      <div class="summary-item">
                        <span class="summary-label">Full Name:</span>
                        <span id="summary-fullName" class="summary-value">-</span>
                      </div>
                      <div class="summary-item">
                        <span class="summary-label">Age:</span>
                        <span id="summary-age" class="summary-value">-</span>
                      </div>
                      <div class="summary-item">
                        <span class="summary-label">Gender:</span>
                        <span id="summary-gender" class="summary-value">-</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Medical Information Summary -->
                  <div class="summary-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-notes-medical text-primary mr-2"></i>
                      Medical Information
                    </h3>
                    <div class="p-3 bg-gray-50 rounded-md">
                      <div class="summary-item">
                        <span class="summary-label">Blood Group:</span>
                        <span id="summary-bloodGroup" class="summary-value">-</span>
                      </div>
                      <div class="summary-item">
                        <span class="summary-label">Genetic Disorders:</span>
                        <span id="summary-geneticDisorders" class="summary-value">-</span>
                      </div>
                      <div class="summary-item">
                        <span class="summary-label">Current Medications:</span>
                        <span id="summary-currentMedications" class="summary-value">-</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Medical History Summary -->
                  <div class="summary-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-file-medical-alt text-primary mr-2"></i>
                      Medical History
                    </h3>
                    <div class="p-3 bg-gray-50 rounded-md">
                      <div class="summary-item">
                        <span class="summary-label">Critical Illnesses:</span>
                        <span id="summary-criticalIllnesses" class="summary-value">-</span>
                      </div>
                      <div class="summary-item">
                        <span class="summary-label">Medical History:</span>
                        <span id="summary-medicalHistory" class="summary-value">-</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Emergency Contacts Summary -->
                  <div class="summary-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-ambulance text-emergency mr-2"></i>
                      Emergency Contacts
                    </h3>
                    <div id="summary-emergencyContacts" class="p-3 bg-gray-50 rounded-md">
                      <!-- Emergency contacts will be added here dynamically -->
                    </div>
                  </div>
                </div>
                
                <div class="flex justify-end mt-4">
                  <button id="edit-profile-btn" class="btn-secondary">
                    <i class="fas fa-edit mr-1"></i> Edit Profile
                  </button>
                </div>
              </div>
              
              <form id="complete-profile-form">
                <div class="form-sections">
                  <!-- Personal Details Section -->
                  <div class="form-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-user-circle text-primary mr-2"></i>
                      Personal Details
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="input-group">
                        <label for="fullName">Full Name <span class="text-emergency">*</span></label>
                        <input type="text" id="fullName" name="fullName" class="form-input" placeholder="John Doe" required>
                      </div>
                      <div class="input-group">
                        <label for="age">Age <span class="text-emergency">*</span></label>
                        <input type="number" id="age" name="age" class="form-input" placeholder="30" required>
                      </div>
                      <div class="input-group">
                        <label for="gender">Gender <span class="text-emergency">*</span></label>
                        <select id="gender" name="gender" class="form-input" required>
                          <option value="">Select Gender</option>
                          <option value="male">Male</option>
                          <option value="female">Female</option>
                          <option value="other">Other</option>
                          <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Medical Information Section -->
                  <div class="form-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-notes-medical text-primary mr-2"></i>
                      Medical Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="input-group">
                        <label for="bloodGroup">Blood Group <span class="text-emergency">*</span></label>
                        <select id="bloodGroup" name="bloodGroup" class="form-input" required>
                          <option value="">Select Blood Group</option>
                          <option value="A+">A+</option>
                          <option value="A-">A-</option>
                          <option value="B+">B+</option>
                          <option value="B-">B-</option>
                          <option value="AB+">AB+</option>
                          <option value="AB-">AB-</option>
                          <option value="O+">O+</option>
                          <option value="O-">O-</option>
                        </select>
                      </div>
                      <div class="input-group">
                        <label for="geneticDisorders">Genetic Disorders</label>
                        <input type="text" id="geneticDisorders" name="geneticDisorders" class="form-input" placeholder="e.g., Cystic Fibrosis">
                      </div>
                      <div class="input-group md:col-span-2">
                        <label for="currentMedications">Current Medications (optional)</label>
                        <textarea id="currentMedications" name="currentMedications" class="form-input" placeholder="e.g., Lisinopril 10mg, Metformin 500mg" rows="2"></textarea>
                      </div>
                      <div class="input-group md:col-span-2">
                        <label for="criticalIllnesses">Critical Illnesses or Conditions</label>
                        <textarea id="criticalIllnesses" name="criticalIllnesses" class="form-input" placeholder="e.g., Diabetes, Hypertension" rows="2"></textarea>
                      </div>
                      <div class="input-group md:col-span-2">
                        <label for="medicalHistory">Previous Medical History</label>
                        <textarea id="medicalHistory" name="medicalHistory" class="form-input" placeholder="e.g., Appendectomy in 2018, Asthma since childhood" rows="3"></textarea>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Medical Documents Section -->
                  <div class="form-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-file-medical text-primary mr-2"></i>
                      Medical Documents
                    </h3>
                    <div class="document-upload-area">
                      <div class="upload-container">
                        <label for="document-upload" class="upload-label">
                          <i class="fas fa-cloud-upload-alt"></i>
                          <span>Drag & drop files or click to browse</span>
                          <small>Supports PDF, JPG, PNG (Max 10MB)</small>
                        </label>
                        <input type="file" id="document-upload" class="hidden" multiple accept=".pdf,.jpg,.jpeg,.png">
                      </div>
                      
                      <div id="uploaded-documents" class="uploaded-documents hidden">
                        <!-- Documents will be added here via JavaScript -->
                      </div>
                    </div>
                  </div>
                  
                  <!-- Emergency Contacts Section -->
                  <div class="form-section">
                    <h3 class="section-subtitle">
                      <i class="fas fa-ambulance text-emergency mr-2"></i>
                      Emergency Contacts
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="input-group">
                        <label for="emergencyName">Contact Name <span class="text-emergency">*</span></label>
                        <input type="text" id="emergencyName" name="emergencyName" class="form-input" placeholder="Jane Doe" required>
                      </div>
                      <div class="input-group">
                        <label for="relationship">Relationship <span class="text-emergency">*</span></label>
                        <input type="text" id="relationship" name="relationship" class="form-input" placeholder="Spouse, Parent, etc." required>
                      </div>
                      <div class="input-group">
                        <label for="phoneNumber">Phone Number <span class="text-emergency">*</span></label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" class="form-input" placeholder="(xxx) xxx-xxxx" required>
                      </div>
                      
                      <div class="input-group md:col-span-3">
                        <div class="flex items-center justify-between">
                          <label>Add another emergency contact</label>
                          <button type="button" id="add-contact" class="btn-icon">
                            <i class="fas fa-plus-circle text-primary"></i>
                          </button>
                        </div>
                      </div>
                      
                      <div id="additional-contacts" class="md:col-span-3">
                        <!-- Additional contacts will be added here via JavaScript -->
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="submit" class="btn-primary">Save Profile Information</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Medical Records Section (initially hidden) -->
        <div id="medical-records-section" class="hidden">
          <h1 class="section-title">Medical Records</h1>
          
          <!-- Upload Medical Reports Card -->
          <div class="card mb-6">
            <div class="card-header">
              <h2 class="card-title">Upload Medical Reports</h2>
            </div>
            <div class="card-content">
              <p class="mb-4 text-gray-600">
                <i class="fas fa-shield-alt text-primary mr-2"></i>
                Upload your medical reports securely. We support PDF and image files (JPG, PNG) up to 10MB.
              </p>
              
              <div class="flex gap-4 mb-4">
                <a href="ocr-upload.html" class="btn-primary flex items-center">
                  <i class="fas fa-file-search mr-2"></i>
                  Upload & Analyze with OCR
                </a>
                <button id="upload-regular-btn" class="btn-primary bg-gray-600 hover:bg-gray-700">
                  <i class="fas fa-cloud-upload-alt mr-2"></i>
                  Regular Upload
                </button>
              </div>
              
              <div id="regular-upload-container" class="document-upload-area hidden">
                <div class="upload-container">
                  <label for="medical-record-upload" class="upload-label">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Drag & drop files or click to browse</span>
                    <small>Supports PDF, JPG, PNG (Max 10MB)</small>
                  </label>
                  <input 
                    type="file" 
                    id="medical-record-upload" 
                    class="hidden" 
                    multiple 
                    accept=".pdf,.jpg,.jpeg,.png"
                  />
                </div>
              </div>
              
              <div id="upload-progress" class="hidden mt-4">
                <div class="flex justify-center items-center">
                  <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                  <span class="ml-2">Uploading...</span>
                </div>
              </div>
              
              <div id="upload-error" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-md">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="error-message"></span>
              </div>
              
              <div id="upload-success" class="hidden mt-4 p-3 bg-green-100 text-green-700 rounded-md">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="success-message"></span>
              </div>
            </div>
          </div>
          
          <!-- Medical Records List Card -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Your Medical Records</h2>
              <button id="refresh-records" class="btn-primary">
                <i class="fas fa-sync-alt mr-1"></i> Refresh
              </button>
            </div>
            <div class="card-content">
              <div id="records-loading" class="hidden">
                <div class="flex justify-center items-center py-8">
                  <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                  <span class="ml-2">Loading records...</span>
                </div>
              </div>
              
              <div id="records-empty" class="hidden">
                <div class="text-center py-8 text-gray-500">
                  <i class="fas fa-folder-open text-4xl mb-3"></i>
                  <p>No medical records found. Upload your first record above.</p>
                </div>
              </div>
              
              <div id="records-list" class="records-list">
                <!-- Records will be added here dynamically -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Emergency Button -->
      <a href="emergency.html" class="emergency-button">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 5a1 1 0 012 0v6a1 1 0 11-2 0V5zm0 9a1 1 0 100 2h.01a1 1 0 100-2H9z" clip-rule="evenodd" />
        </svg>
        Emergency
      </a>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        const isLoggedIn = localStorage.getItem('medivault_logged_in') === 'true';
        if (!isLoggedIn) {
          window.location.href = 'login.html';
          return;
        }

        // Load user data
        const userData = JSON.parse(localStorage.getItem('medivault_user_data') || '{}');
        
        // Update profile information
        document.getElementById('user-name').textContent = userData.firstName || 'User';
        document.getElementById('profile-name').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`;
        document.getElementById('profile-email').textContent = userData.email || '';
        
        // Show blood type only if available
        const bloodTypeContainer = document.getElementById('profile-bloodtype-container');
        const bloodTypeElement = document.getElementById('profile-bloodtype');
        
        if (userData.profileCompletion && userData.profileCompletion.bloodGroup) {
          bloodTypeElement.textContent = userData.profileCompletion.bloodGroup;
          bloodTypeContainer.classList.remove('hidden');
        } else if (userData.emergencyInfo && userData.emergencyInfo.bloodGroup) {
          bloodTypeElement.textContent = userData.emergencyInfo.bloodGroup;
          bloodTypeContainer.classList.remove('hidden');
        } else {
          bloodTypeContainer.classList.add('hidden');
        }
        
        // Mobile sidebar toggle
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
        });
        
        // User dropdown toggle
        const userMenuBtn = document.getElementById('user-menu-btn');
        const userDropdown = document.getElementById('user-dropdown');
        
        userMenuBtn.addEventListener('click', function() {
          userDropdown.classList.toggle('hidden');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.classList.add('hidden');
          }
        });
        
        // Logout functionality
        const logoutBtn = document.getElementById('logout-btn');
        
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('medivault_logged_in');
          window.location.href = 'login.html';
        });

        // Profile Completion Form Handling
        const completeProfileForm = document.getElementById('complete-profile-form');
        if (completeProfileForm) {
          // Pre-fill form fields if data exists
          if (userData.profileCompletion) {
            const pc = userData.profileCompletion;
            if (pc.fullName) document.getElementById('fullName').value = pc.fullName;
            if (pc.age) document.getElementById('age').value = pc.age;
            if (pc.gender) document.getElementById('gender').value = pc.gender;
            if (pc.bloodGroup) document.getElementById('bloodGroup').value = pc.bloodGroup;
            if (pc.geneticDisorders) document.getElementById('geneticDisorders').value = pc.geneticDisorders;
            if (pc.currentMedications) document.getElementById('currentMedications').value = pc.currentMedications;
            if (pc.criticalIllnesses) document.getElementById('criticalIllnesses').value = pc.criticalIllnesses;
            if (pc.medicalHistory) document.getElementById('medicalHistory').value = pc.medicalHistory;
            if (pc.emergencyContacts && pc.emergencyContacts.length > 0) {
              document.getElementById('emergencyName').value = pc.emergencyContacts[0].name || '';
              document.getElementById('relationship').value = pc.emergencyContacts[0].relationship || '';
              document.getElementById('phoneNumber').value = pc.emergencyContacts[0].phoneNumber || '';
              
              // Add additional contacts
              if (pc.emergencyContacts.length > 1) {
                for (let i = 1; i < pc.emergencyContacts.length; i++) {
                  addEmergencyContact(pc.emergencyContacts[i]);
                }
              }
            }
            
            // Show summary if profile is already filled
            const profileSummary = document.getElementById('profile-summary');
            if (pc.fullName && pc.bloodGroup) {
              populateProfileSummary(pc);
              completeProfileForm.classList.add('hidden');
              profileSummary.classList.remove('hidden');
            }
            
            // Update progress
            updateProfileCompletionProgress();
          }
          
          // Handle file upload
          const documentUpload = document.getElementById('document-upload');
          const uploadedDocuments = document.getElementById('uploaded-documents');
          
          documentUpload.addEventListener('change', function(e) {
            if (!e.target.files.length) return;
            
            uploadedDocuments.classList.remove('hidden');
            
            for (let i = 0; i < e.target.files.length; i++) {
              const file = e.target.files[i];
              const reader = new FileReader();
              
              reader.onload = function(event) {
                const docElement = document.createElement('div');
                docElement.className = 'document-preview';
                
                let iconClass = 'fa-file';
                if (file.type.includes('pdf')) {
                  iconClass = 'fa-file-pdf';
                } else if (file.type.includes('image')) {
                  iconClass = 'fa-file-image';
                }
                
                docElement.innerHTML = `
                  <div class="document-preview-image">
                    <i class="fas ${iconClass} fa-2x"></i>
                  </div>
                  <div class="document-preview-info">
                    <div class="truncate">${file.name}</div>
                    <div class="text-xs text-gray-500">${formatFileSize(file.size)}</div>
                  </div>
                  <div class="document-preview-actions">
                    <button type="button" class="remove-document" aria-label="Remove document">
                      <i class="fas fa-times-circle"></i>
                    </button>
                  </div>
                `;
                
                uploadedDocuments.appendChild(docElement);
                
                // Handle document removal
                docElement.querySelector('.remove-document').addEventListener('click', function() {
                  docElement.remove();
                  if (uploadedDocuments.children.length === 0) {
                    uploadedDocuments.classList.add('hidden');
                  }
                  updateProfileCompletionProgress();
                });
                
                updateProfileCompletionProgress();
              };
              
              reader.readAsDataURL(file);
            }
          });
          
          // Add emergency contact handler
          const addContactBtn = document.getElementById('add-contact');
          const additionalContacts = document.getElementById('additional-contacts');
          
          addContactBtn.addEventListener('click', function() {
            addEmergencyContact();
          });
          
          function addEmergencyContact(contact = {}) {
            const contactId = Date.now();
            const contactElement = document.createElement('div');
            contactElement.className = 'grid grid-cols-1 md:grid-cols-3 gap-4 border border-gray-200 p-3 rounded-lg mt-3';
            contactElement.dataset.contactId = contactId;
            
            contactElement.innerHTML = `
              <div class="input-group">
                <label for="emergencyName-${contactId}">Contact Name</label>
                <input type="text" id="emergencyName-${contactId}" name="emergencyName-${contactId}" class="form-input" placeholder="Jane Doe" value="${contact.name || ''}">
              </div>
              <div class="input-group">
                <label for="relationship-${contactId}">Relationship</label>
                <input type="text" id="relationship-${contactId}" name="relationship-${contactId}" class="form-input" placeholder="Spouse, Parent, etc." value="${contact.relationship || ''}">
              </div>
              <div class="input-group" style="position: relative;">
                <label for="phoneNumber-${contactId}">Phone Number</label>
                <input type="tel" id="phoneNumber-${contactId}" name="phoneNumber-${contactId}" class="form-input" placeholder="(xxx) xxx-xxxx" value="${contact.phoneNumber || ''}">
                <button type="button" class="remove-contact btn-icon" style="position: absolute; top: 0; right: -8px;">
                  <i class="fas fa-times-circle text-emergency"></i>
                </button>
              </div>
            `;
            
            additionalContacts.appendChild(contactElement);
            
            // Handle contact removal
            contactElement.querySelector('.remove-contact').addEventListener('click', function() {
              contactElement.remove();
              updateProfileCompletionProgress();
            });
          }
          
          // Form submission
          completeProfileForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const profileData = {
              fullName: document.getElementById('fullName').value,
              age: document.getElementById('age').value,
              gender: document.getElementById('gender').value,
              bloodGroup: document.getElementById('bloodGroup').value,
              geneticDisorders: document.getElementById('geneticDisorders').value,
              currentMedications: document.getElementById('currentMedications').value,
              criticalIllnesses: document.getElementById('criticalIllnesses').value,
              medicalHistory: document.getElementById('medicalHistory').value,
              emergencyContacts: [
                {
                  name: document.getElementById('emergencyName').value,
                  relationship: document.getElementById('relationship').value,
                  phoneNumber: document.getElementById('phoneNumber').value
                }
              ],
              documentsCount: uploadedDocuments.children.length
            };
            
            // Collect additional emergency contacts
            const additionalContactElements = additionalContacts.querySelectorAll('[data-contact-id]');
            additionalContactElements.forEach(function(element) {
              const contactId = element.dataset.contactId;
              profileData.emergencyContacts.push({
                name: document.getElementById(`emergencyName-${contactId}`).value,
                relationship: document.getElementById(`relationship-${contactId}`).value,
                phoneNumber: document.getElementById(`phoneNumber-${contactId}`).value
              });
            });
            
            // Save to user data
            userData.profileCompletion = profileData;
            
            // Extract and save critical medical information for emergency use
            userData.emergencyInfo = {
              fullName: profileData.fullName,
              bloodGroup: profileData.bloodGroup,
              criticalIllnesses: profileData.criticalIllnesses || "None",
              allergies: profileData.geneticDisorders || "None",  // Using genetic disorders field for allergies in this example
              medications: profileData.currentMedications || "None",
              emergencyContacts: profileData.emergencyContacts,
              lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('medivault_user_data', JSON.stringify(userData));
            
            // Show success toast
            showToast('Profile updated successfully');
            
            // Update profile name in the navigation
            document.getElementById('user-name').textContent = profileData.fullName || 'User';
            document.getElementById('profile-name').textContent = profileData.fullName || 'User';
            
            // Update blood type display
            if (profileData.bloodGroup) {
              document.getElementById('profile-bloodtype').textContent = profileData.bloodGroup;
              document.getElementById('profile-bloodtype-container').classList.remove('hidden');
            } else {
              document.getElementById('profile-bloodtype-container').classList.add('hidden');
            }
            
            // Populate emergency contacts
            const emergencyContactsDiv = document.getElementById('summary-emergencyContacts');
            emergencyContactsDiv.innerHTML = '';
            
            profileData.emergencyContacts.forEach(function(contact, index) {
              const contactDiv = document.createElement('div');
              contactDiv.className = 'summary-contact p-2 mb-2 border-b border-gray-200';
              if (index === profileData.emergencyContacts.length - 1) {
                contactDiv.classList.remove('border-b');
              }
              
              contactDiv.innerHTML = `
                <div class="font-medium">${contact.name}</div>
                <div class="text-sm text-gray-600">${contact.relationship} • ${contact.phoneNumber}</div>
              `;
              
              emergencyContactsDiv.appendChild(contactDiv);
            });
            
            // Update progress
            updateProfileCompletionProgress();
            
            // Populate summary view
            populateProfileSummary(profileData);
            
            // Animate form hiding
            completeProfileForm.classList.add('slide-up-fade-out');
            
            // Show summary after animation completes
            setTimeout(function() {
              completeProfileForm.classList.add('hidden');
              completeProfileForm.classList.remove('slide-up-fade-out');
              
              const profileSummary = document.getElementById('profile-summary');
              profileSummary.classList.remove('hidden');
              profileSummary.classList.add('slide-down-fade-in');
            }, 500);
          });
          
          // Function to show toast notification
          function showToast(message) {
            // Remove existing toast if any
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
              existingToast.remove();
            }
            
            // Create and show new toast
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fas fa-check-circle mr-2"></i> ${message}`;
            document.body.appendChild(toast);
            
            // Remove toast after animation completes
            setTimeout(function() {
              toast.remove();
            }, 3500);
          }
          
          // Function to populate profile summary
          function populateProfileSummary(profileData) {
            // Set text content for all summary fields
            document.getElementById('summary-fullName').textContent = profileData.fullName || '-';
            document.getElementById('summary-age').textContent = profileData.age || '-';
            document.getElementById('summary-gender').textContent = profileData.gender || '-';
            document.getElementById('summary-bloodGroup').textContent = profileData.bloodGroup || '-';
            document.getElementById('summary-geneticDisorders').textContent = profileData.geneticDisorders || 'None';
            document.getElementById('summary-currentMedications').textContent = profileData.currentMedications || 'None';
            document.getElementById('summary-criticalIllnesses').textContent = profileData.criticalIllnesses || 'None';
            document.getElementById('summary-medicalHistory').textContent = profileData.medicalHistory || 'None';
            
            // Update the blood type in the header if available
            if (profileData.bloodGroup) {
              document.getElementById('profile-bloodtype').textContent = profileData.bloodGroup;
              document.getElementById('profile-bloodtype-container').classList.remove('hidden');
            } else {
              document.getElementById('profile-bloodtype-container').classList.add('hidden');
            }
            
            // Populate emergency contacts
            const emergencyContactsDiv = document.getElementById('summary-emergencyContacts');
            emergencyContactsDiv.innerHTML = '';
            
            profileData.emergencyContacts.forEach(function(contact, index) {
              const contactDiv = document.createElement('div');
              contactDiv.className = 'summary-contact p-2 mb-2 border-b border-gray-200';
              if (index === profileData.emergencyContacts.length - 1) {
                contactDiv.classList.remove('border-b');
              }
              
              contactDiv.innerHTML = `
                <div class="font-medium">${contact.name}</div>
                <div class="text-sm text-gray-600">${contact.relationship} • ${contact.phoneNumber}</div>
              `;
              
              emergencyContactsDiv.appendChild(contactDiv);
            });
          }
          
          // Update profile completion progress
          function updateProfileCompletionProgress() {
            const form = document.getElementById('complete-profile-form');
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            const filledRequiredFields = Array.from(requiredFields).filter(field => field.value.trim() !== '');
            
            const totalFields = form.querySelectorAll('input:not([type="file"]), select, textarea').length;
            const filledFields = Array.from(form.querySelectorAll('input:not([type="file"]), select, textarea')).filter(field => field.value.trim() !== '').length;
            
            // Documents count
            const documentsCount = document.getElementById('uploaded-documents').children.length;
            
            // Calculate percentage (giving more weight to required fields)
            const requiredFieldsWeight = 0.7;
            const optionalFieldsWeight = 0.2;
            const documentsWeight = 0.1;
            
            const requiredPercentage = requiredFields.length ? (filledRequiredFields.length / requiredFields.length) * requiredFieldsWeight : 0;
            const optionalPercentage = totalFields - requiredFields.length > 0 ? 
              ((filledFields - filledRequiredFields.length) / (totalFields - requiredFields.length)) * optionalFieldsWeight : 0;
            const documentsPercentage = documentsCount > 0 ? documentsWeight : 0;
            
            const totalPercentage = Math.min(Math.round((requiredPercentage + optionalPercentage + documentsPercentage) * 100), 100);
            
            // Update UI
            document.getElementById('progress-fill').style.width = `${totalPercentage}%`;
            document.getElementById('completion-percentage').textContent = `${totalPercentage}% Complete`;
            
            return totalPercentage;
          }
          
          // Helper to format file size
          function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
          }
        }

        // Navigation and Section Display
        const dashboardLink = document.getElementById('dashboard-link');
        const medicalRecordsLink = document.getElementById('medical-records-link');
        const dashboardSection = document.getElementById('dashboard-section');
        const medicalRecordsSection = document.getElementById('medical-records-section');
        
        // Navigation handlers
        dashboardLink.addEventListener('click', function(e) {
          e.preventDefault();
          dashboardSection.classList.remove('hidden');
          medicalRecordsSection.classList.add('hidden');
          
          // Update active state in sidebar
          dashboardLink.classList.add('active');
          medicalRecordsLink.classList.remove('active');
        });
        
        medicalRecordsLink.addEventListener('click', function(e) {
          e.preventDefault();
          dashboardSection.classList.add('hidden');
          medicalRecordsSection.classList.remove('hidden');
          
          // Update active state in sidebar
          dashboardLink.classList.remove('active');
          medicalRecordsLink.classList.add('active');
          
          // Fetch records when navigating to this section
          fetchMedicalRecords();
        });
        
        // Medical Records Functionality
        const fileInput = document.getElementById('medical-record-upload');
        const uploadContainer = document.querySelector('#regular-upload-container .upload-container');
        const uploadProgress = document.getElementById('upload-progress');
        const uploadError = document.getElementById('upload-error');
        const errorMessage = document.getElementById('error-message');
        const uploadSuccess = document.getElementById('upload-success');
        const successMessage = document.getElementById('success-message');
        const recordsList = document.getElementById('records-list');
        const recordsLoading = document.getElementById('records-loading');
        const recordsEmpty = document.getElementById('records-empty');
        const refreshButton = document.getElementById('refresh-records');
        
        // Add drag and drop functionality
        if (uploadContainer) {
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, preventDefaults, false);
          });
          
          function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
          }
          
          ['dragenter', 'dragover'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, highlight, false);
          });
          
          ['dragleave', 'drop'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, unhighlight, false);
          });
          
          function highlight() {
            uploadContainer.classList.add('border-primary', 'bg-blue-50');
          }
          
          function unhighlight() {
            uploadContainer.classList.remove('border-primary', 'bg-blue-50');
          }
          
          uploadContainer.addEventListener('drop', handleDrop, false);
          
          function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
              handleFiles(files);
            }
          }
          
          // Make the whole container clickable
          uploadContainer.addEventListener('click', () => {
            fileInput.click();
          });
        }
        
        // File Upload Event Listener
        if (fileInput) {
          fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
          });
        }
        
        // Refresh button event listener
        if (refreshButton) {
          refreshButton.addEventListener('click', fetchMedicalRecords);
        }
        
        // Handle files (both from input and drag-drop)
        function handleFiles(files) {
          if (!files || files.length === 0) return;
          
          // Hide previous messages
          if (uploadError) uploadError.classList.add('hidden');
          if (uploadSuccess) uploadSuccess.classList.add('hidden');
          
          // Show progress indicator
          if (uploadProgress) uploadProgress.classList.remove('hidden');
          
          // Validate files
          const invalidFiles = Array.from(files).filter(file => {
            // Check file type
            const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            if (!validTypes.includes(file.type)) {
              return true;
            }
            
            // Check file size (max 10MB)
            const maxSize = 10 * 1024 * 1024; // 10MB in bytes
            if (file.size > maxSize) {
              return true;
            }
            
            return false;
          });
          
          if (invalidFiles.length > 0) {
            if (uploadProgress) uploadProgress.classList.add('hidden');
            if (uploadError) {
              uploadError.classList.remove('hidden');
              errorMessage.textContent = 'Invalid files detected. Please ensure all files are PDF or images (JPG, PNG) under 10MB.';
            }
            return;
          }
          
          // Process valid files
          const uploadPromises = Array.from(files).map(file => {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              
              reader.onload = function(e) {
                try {
                  // In a real application, this would be an API call to upload to MongoDB
                  // For this demo, we'll store in localStorage
                  saveRecordToLocalStorage(file, e.target.result);
                  resolve();
                } catch (error) {
                  reject(error);
                }
              };
              
              reader.onerror = function() {
                reject(new Error(`Error reading file: ${file.name}`));
              };
              
              // Read file as data URL for demo purposes
              reader.readAsDataURL(file);
            });
          });
          
          // Process all uploads
          Promise.all(uploadPromises)
            .then(() => {
              // Hide progress and show success
              if (uploadProgress) uploadProgress.classList.add('hidden');
              if (uploadSuccess) {
                uploadSuccess.classList.remove('hidden');
                successMessage.textContent = `Successfully uploaded ${files.length} file(s).`;
              }
              
              // Clear file input
              if (fileInput) fileInput.value = '';
              
              // Refresh records list
              fetchMedicalRecords();
              
              // Hide success message after 3 seconds
              setTimeout(() => {
                if (uploadSuccess) uploadSuccess.classList.add('hidden');
              }, 3000);
            })
            .catch(error => {
              // Handle errors
              if (uploadProgress) uploadProgress.classList.add('hidden');
              if (uploadError) {
                uploadError.classList.remove('hidden');
                errorMessage.textContent = error.message || 'An error occurred during upload.';
              }
            });
        }
        
        // Save record to localStorage
        function saveRecordToLocalStorage(file, dataUrl) {
          // Get existing records or initialize empty array
          const existingRecords = JSON.parse(localStorage.getItem('medicalRecords') || '[]');
          
          // Create new record object
          const newRecord = {
            id: Date.now().toString(), // Generate a unique ID
            fileName: file.name,
            fileType: file.type,
            fileSize: file.size,
            uploadDate: new Date().toISOString(),
            dataUrl: dataUrl // In a real app, this would be a MongoDB reference
          };
          
          // Add new record to array
          existingRecords.push(newRecord);
          
          // Save back to localStorage
          localStorage.setItem('medicalRecords', JSON.stringify(existingRecords));
        }
        
        // Fetch medical records from localStorage
        function fetchMedicalRecords() {
          if (!recordsList || !recordsLoading || !recordsEmpty) return;
          
          // Show loading indicator
          recordsList.innerHTML = '';
          recordsLoading.classList.remove('hidden');
          recordsEmpty.classList.add('hidden');
          
          // Simulate network delay for demo purposes
          setTimeout(() => {
            // Get records from localStorage
            const records = JSON.parse(localStorage.getItem('medicalRecords') || '[]');
            
            // Hide loading indicator
            recordsLoading.classList.add('hidden');
            
            // If no records, show empty state
            if (records.length === 0) {
              recordsEmpty.classList.remove('hidden');
              return;
            }
            
            // Sort records by upload date (newest first)
            records.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
            
            // Display records
            records.forEach(record => {
              const recordElement = createRecordElement(record);
              recordsList.appendChild(recordElement);
            });
          }, 500); // 500ms delay for demo
        }
        
        // Create record element
        function createRecordElement(record) {
          const recordElement = document.createElement('div');
          recordElement.className = 'record-item';
          recordElement.dataset.id = record.id;
          
          // Get file type display
          const fileTypeDisplay = getFileTypeDisplay(record.fileType);
          
          // Get formatted file size
          const formattedSize = formatFileSize(record.fileSize);
          
          // Format date for display
          const formattedDate = formatDate(record.uploadDate);
          
          recordElement.innerHTML = `
            <div class="record-icon">
              <i class="${fileTypeDisplay.icon}"></i>
            </div>
            <div class="record-details">
              <h3 class="record-name">${record.fileName}</h3>
              <div class="record-meta">
                <span class="record-type">${fileTypeDisplay.name}</span>
                <span class="record-size">${formattedSize}</span>
                <span class="record-date">${formattedDate}</span>
              </div>
            </div>
            <div class="record-actions">
              <button class="btn-icon view-record" title="View" data-id="${record.id}">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-icon download-record" title="Download" data-id="${record.id}">
                <i class="fas fa-download"></i>
              </button>
              <button class="btn-icon analyze-record" title="Analyze with OCR" data-id="${record.id}">
                <i class="fas fa-file-search"></i>
              </button>
              <button class="btn-icon delete-record" title="Delete" data-id="${record.id}">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          `;
          
          // Add event listeners to action buttons
          recordElement.querySelector('.view-record').addEventListener('click', () => viewRecord(record));
          recordElement.querySelector('.download-record').addEventListener('click', () => downloadRecord(record));
          recordElement.querySelector('.analyze-record').addEventListener('click', () => analyzeRecord(record));
          recordElement.querySelector('.delete-record').addEventListener('click', () => deleteRecord(record.id));
          
          return recordElement;
        }
        
        // Helper: Get file type display information
        function getFileTypeDisplay(mimeType) {
          if (mimeType === 'application/pdf') {
            return { name: 'PDF Document', icon: 'fas fa-file-pdf text-red-500' };
          } else if (mimeType.startsWith('image/')) {
            return { name: 'Image', icon: 'fas fa-file-image text-blue-500' };
          } else {
            return { name: 'Document', icon: 'fas fa-file text-gray-500' };
          }
        }
        
        // Helper: Format file size
        function formatFileSize(bytes) {
          if (bytes < 1024) {
            return bytes + ' bytes';
          } else if (bytes < 1024 * 1024) {
            return (bytes / 1024).toFixed(1) + ' KB';
          } else {
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
          }
        }
        
        // Helper: Format date
        function formatDate(dateString) {
          const date = new Date(dateString);
          return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        // View Record
        function viewRecord(record) {
          // In a real app, this would likely open a modal or redirect to a viewer
          
          // Simple implementation that opens the data URL in a new tab
          if (record.dataUrl) {
            window.open(record.dataUrl, '_blank');
          }
        }
        
        // Download Record
        function downloadRecord(record) {
          // Create a temporary anchor element
          const a = document.createElement('a');
          a.href = record.dataUrl;
          a.download = record.fileName;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
        
        // Analyze Record with OCR
        function analyzeRecord(record) {
          // Save the record data to session storage so it can be accessed by the OCR page
          sessionStorage.setItem('ocr_record', JSON.stringify({
            id: record.id,
            fileName: record.fileName,
            dataUrl: record.dataUrl,
            fileType: record.fileType
          }));
          
          // Redirect to the OCR upload page
          window.location.href = 'ocr-upload.html?source=record&id=' + record.id;
        }
        
        // Delete Record
        function deleteRecord(recordId) {
          if (!confirm('Are you sure you want to delete this record?')) {
            return;
          }
          
          // Get existing records
          const records = JSON.parse(localStorage.getItem('medicalRecords') || '[]');
          
          // Filter out the record to delete
          const updatedRecords = records.filter(record => record.id !== recordId);
          
          // Save back to localStorage
          localStorage.setItem('medicalRecords', JSON.stringify(updatedRecords));
          
          // Refresh the display
          fetchMedicalRecords();
          
          // Show success message
          if (uploadSuccess) {
            uploadSuccess.classList.remove('hidden');
            successMessage.textContent = 'Record deleted successfully.';
            
            // Hide success message after 3 seconds
            setTimeout(() => {
              uploadSuccess.classList.add('hidden');
            }, 3000);
          }
        }

        // Edit profile button functionality
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const editProfileBtnHeader = document.getElementById('edit-profile-btn-header');
        
        function showProfileForm() {
          const profileSummary = document.getElementById('profile-summary');
          if (profileSummary && !profileSummary.classList.contains('hidden')) {
            profileSummary.classList.add('slide-up-fade-out');
            
            // Show form after animation completes
            setTimeout(function() {
              profileSummary.classList.add('hidden');
              profileSummary.classList.remove('slide-up-fade-out');
              
              const completeProfileForm = document.getElementById('complete-profile-form');
              completeProfileForm.classList.remove('hidden');
              completeProfileForm.classList.add('slide-down-fade-in');
              
              // Remove animation class after completion
              setTimeout(function() {
                completeProfileForm.classList.remove('slide-down-fade-in');
              }, 500);
            }, 500);
          } else {
            // If summary is not visible yet, just scroll to the form section
            const completeProfileForm = document.getElementById('complete-profile-form');
            if (completeProfileForm.classList.contains('hidden')) {
              completeProfileForm.classList.remove('hidden');
            }
            completeProfileForm.scrollIntoView({ behavior: 'smooth' });
          }
        }
        
        if (editProfileBtn) {
          editProfileBtn.addEventListener('click', showProfileForm);
        }
        
        if (editProfileBtnHeader) {
          editProfileBtnHeader.addEventListener('click', showProfileForm);
        }

        // Toggle regular upload section
        const uploadRegularBtn = document.getElementById('upload-regular-btn');
        const regularUploadContainer = document.getElementById('regular-upload-container');
        
        if (uploadRegularBtn && regularUploadContainer) {
          uploadRegularBtn.addEventListener('click', function() {
            regularUploadContainer.classList.toggle('hidden');
            
            if (!regularUploadContainer.classList.contains('hidden')) {
              regularUploadContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
          });
        }
      });
    </script>
  </body>
</html> 

